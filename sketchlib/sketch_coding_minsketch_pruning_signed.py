#! python3
# -*- coding: utf-8 -*-
# Modified by En-Yu Yang for indicating sign bit by another bit in indicator
# Remove the 1/base part

import numpy as np
import sys
import ctypes

hash_value_1 = (258067886,689096243,598348823,991226873,264751823,584932742,921642287,697505998,1005978584,411298311,241043657,46076885,153806930,651221499,104968686,1002352928,286779620,83126051,711096296,916819329,711926180,939041368,929955721,986697408,278838451,365518694,443617020,1019046868,774918634,150160294,499700389,635775622,948867437,386911821,499673741,281285421,1010888665,827450038,178566631,773605879,942705250,975963622,169153473,214963723,976212658,973977975,1022163954,424849531,863411279,430404168,954060281,476725927,62684310,970157494,572879832,245840892,1000426257,1056861544,592342945,50714437,659523922,271201354,283409252,867539012,237314008,298768350,663059850,403935156,834622583,180958318,654266880,637268265,360238388,384956974,3652777,759389578,435831667,955449473,299172253,589767330,433008835,344630082,340094388,611136646,849650260,879665840,601723162,268627287,258514600,11953071,708211348,691177082,34703200,26156770,629492906,751142415,367554914,975837557,854223606,387500769,943342996,593545050,656785736,607519414,887386238,803521031,283389507,665312973,260110864,681546629,2253239,589014417,626367186,190932560,302658210,412438161,878746554,413553665,596847519,215357574,420837228,167037154,1068245392,738846705,259098735,1069166218,949540531,1070210944,682043016,798899771,230006990,352947214,1006380837,38446277,734514553,398985001,156244835,325972655,903490128,1040194737,634208627,916030658,768356988,416839939,981798747,320066930,262156529,957923203,763031590,440650274,717170208,389479328,204972052,281279513,746428985,925548196,427928110,225598310,428996958,771057009,546778700,348238919,64185002,357232859,633936723,126573033,837099892,76913483,519946202,644102137,276806247,930579614,60218901,408186726,283228998,484842445,847268770,285018718,710848023,167761005,840514327,835557656,25422875,89942411,597145571,52157601,129468138,806205710,399074116,93333076,258012610,43739232,213010519,418791388,1038861198,777859800,994206677,398117697,211538699,390435348,212701959,71728663,590418007,1062407051,376500716,425285902,780542998,533185280,30935489,747056258,701343047,111080856,725116513,233889156,8163893,626360431,332265757,317772572,81928514,985103175,198005942,354391633,941045574,636757673,781579945,245539218,182484696,264262202,630539043,25802533,506807696,430858785,1057291476,760832198,137347105,776487119,620315406,892716718,869782673,28379290,128123420,288628882,219662003,487425739,341834164,606597591,778234623,862224158,1046224293,648687627,803548184,707060583,1068065644,952296445,1008434928,894275323,496677609,962129641,261830701,734226729,580806990,1027007164,51218100,602369316,859500910,265487202,668874201,434686652,148679909,385076690,408306643,769609454,813598692,415579160,597922170,794204337,33556396,755625490,467986700,104472511,221469747,245332493,869262569,853949069,142350222,668613982,124461536,66678933,156627,886252801,62017474,534483974,794714994,464444784,341741739,126409807,1073011190,568905981,115695869,191547363,1068142595,77594306,788072611,354951842,899236052,828605360,1033891150,235151266,280968108,57941790,379022722,411684029,5456000,820235202,489416652,795882505,972361737,1003293346,49809341,962245721,441146310,605949741,714499620,377514759,249333192,387261266,959994066,234239557,506741824,424069322,301409980,423248678,844002355,756457929,359617823,252659853,581058871,561705280,328660315,868653302,612567988,95367550,326633751,621497058,61018455,605577549,678718391,694126785,558840310,817865408,379148237,882087044,356459484,578726553,77960149,1052000085,1008006884,861672679,481835974,275823773,625500248,971153717,1040108528,396388413,270384144,946168445,700968130,477825394,465870170,975814678,899120787,730826172,416639207,416919164,475138927,77145121,471129776,202375288,434537625,345733707,752395001,548553337,882175231,627819566,334159900,771084445,440622820,497965305,761547471,387856257,276430983,69709979,432870674,736715803,54448139,58001063,382426024,646284425,408361795,1028568506,327761672,281381362,963752042,350059062,888673987,408797552,138025213,1031874667,1023185885,268782425,658811628,208323961,516954211,572048251,678420748,751140821,527808534,332328612,834329670,70122731,246286185,1063796586,218159936,409085749,428749504,420231443,127784825,759234419,541829907,802035974,613962080,891176946,940679804,646133086,525110058,214026420,981819007,649888150,262430457,711149236,617241653,1073012165,359279806,531683815,632281928,213055866,892843191,342633129,507843159,1060466557,563951667,697944876,495133562,319965580,810755995,17184223,519826217,465752734,1024688362,450804434,158632473,916482197,1064031104,573963747,877639638,82181073,349570459,716153287,756083216,99884591,12729114,913239731,245873776,1068198989,181076723,725462304,462602181,675516412,448327157,218165813,307470019,161624726,465194334,1014593853,921779619,159775276,625751058,38421029,451489295,1067808662,268420918,692651171,644732224,693562458,108607975,562885381,771822315,316348889,532756562,213978527,561006995,40736815,554181640,296651376,301576950,792252863,125507447,150718993,38593573,102346678,370824726,121692092,170312648,794606238,764023305,760076475,529032534,311307120,828281425,1058015445,159197916,601463544,637207276,475991012,722190859,139757073,853423762,885741546,509361580,1037432075,746591120,508377542,416017115,299925522,496268640,453609113,242387164,279666396,349022263,131818157,513846926,791134907,531607806,262460713,1027774150,22564575,719739211,270712637,492908887,1031226233,123627737,142230577,966046858,824569218,24671908,29812080,627305007,459670616,1003860955,323523154,305529474,521378932,831799267,467490116,108096779,488441379,94790630,1020827718,797823045,649846747,696628179,214629514,839860469,75103822,645778560,208298216,705462956,976885726,173516655,199014258,462273824,296459654,475629723,930367069,49520267,167418374,421379304,862518496,335408420,498137808,787497815,1031808579,411217163,480205728,855419819,763411823,222390705,88517970,524470848,419613048,788857328,189641956,973349448,119707964,437448373,631340655,742880322,139375687,159059627,68715161,1017399152,493682795,17205462,689681333,1067778739,469487854,233753379,867476840,910602293,698986211,403210504,62562051,551473827,908448040,231452065,152240485,349298755,464841752,42439610,403643446,659739209,195197837,568359107,477660610,1044129208,308374591,572933686,29279140,448953277,778194705,730671057,510287413,1033290645,555963029,1037522488,466071097,881816634,475937439,851276822,957526644,207912072,272164317,11998001,798773018,56702349,660156857,765588954,258809129,79811915,597125616,400061363,509606217,502787272,702435614,764795555,125914451,574564214,240708813,558954975,699456741,684252910,534835474,23020824,959533009,836661523,834219741,320230676,782309908,209027901,625935349,95311297,941649912,423246939,946046918,469179059,433980279,523053498,39379642,912190842,39811953,327362902,96077550,748464033,1048448814,722126092,100586654,91430927,476162912,453747207,763045697,224203502,171511867,324323023,1021430081,579245693,613001067,1009907191,247090830,913662582,192185563,632763941,638284708,1006672709,561499473,193496711,390529759,998163689,325442101,744867575,41622152,721965809,581113790,524518117,944934450,144158018,1056461142,285501115,1055775056,510141211,253760314,870674544,1024973109,25566785,4166585,312621036,152628154,1017772894,993891919,554547061,846120459,859266192,19126551,90850219,296911686,721497500,888309198,988507740,598395248,841293621,203355350,256513745,524706881,823192295,628093551,13844995,660644815,103142428,20245254,389275381,617305411,31260526,159518526,52961525,883882603,410219537,348405043,256305809,153768536,416597845,361109119,654943904,627689840,84416603,384234629,104512717,57742934,621481083,917924089,808335891,260099041,971251502,24596720,940545284,152076041,89710252,693571229,382405887,317354981,204788856,583924155,138610781,126559566,755574815,270329268,690916371,686355172,560815639,398163555,976287495,664589135,212033089,954911077,836642117,587499366,848285574,1012475921,300368082,303731727,65408742,784636726,469519344,827516088,878179967,124221874,904300704,130316630,465659900,858456597,263584479,446103301,254254224,430953824,933012483,790091826,689440837,739003222,995540482,415227759,64468334,26897404,32173055,16364700,774664092,179283810,760504214,527094905,710565692,407546518,411095309,655661932,407108659,505946919,418912017,220836208,318202163,582984042,1054347670,247905908,153583673,986050203,308827538,468058560,823199823,930761134,656095638,311967293,725347450,866012911,494794261,446043913,504339751,658749140,635973669,100576883,611186806,758740081,541149460,928089719,798348197,140949402,542306986,268935317,722402258,854301530,572881014,707007986,1069612134,3973037,212796204,932410879,953530911,183553925,867365990,486564153,769032822,948281832,1047510121,132716908,1030470735,863181054,651540598,823866144,740999694,391489871,448084531,310483990,242767113,786968364,55993284,318452625,531140831,572073816,999477007,224688374,741218018,977610300,864488724,788853155,48470803,435654076,419424020,1034073615,43815348,370233515,553783188,467927815,317252376,957445164,316256745,892254728,872092108,1003947472,735027662,445818122,537563009,1027772251,857846754,383727191,681908769,663521252,144562054,109931831,880662910,194088396,437663331,550580885,719995841,391536151,201137913,416663626,631613965,667206493,128964459,1004857189,655107259,631955405,72680710,473782720,845575428,554585081,907791989,915472236,631993356,719842347,557992975,98385132,136849074,544596223,871709667,69094241,979235886,621847062,623035255,250312397,650711345,939246052,284498484,791373448,302380211,337132200,786505817,212981931,265933050,1045558222,777131742,192962282,309870214,632450392,965779912,331381685,1038874975,198535998,746241289,62620918,465718804,699086749,180612268,193360947,831092238,514352453,137397114,317922212,33069619,14161991,960085043,1013991643,128157267,63475748,432277584,967158688,713722794,594650351,295123993,923166175,533371596,1049925785,984288529,117441306,993687258,412730395,764927334,330013522,96060677,627970899,530209209,1005254783,774079920,1055640028,751539562,747922420,382459868,501398027,401461265,452674951)
hash_value_2 = (1004474241,423647706,290181203,751248502,562297496,256318667,648992626,994025599,805741025,639896611,1017742721,398828558,789657088,677715215,597816133,916320332,313684050,220154030,644338656,876266558,999273456,555493007,87648094,386235130,447458689,327942290,885161385,703084915,784796265,792496063,972865171,811982067,583404477,803693982,838666579,646196760,261664502,1031539221,57619772,475132468,98771615,244583019,870901382,195170715,882544267,529769520,992788836,197751995,667566583,145976148,804190556,1011883035,578586703,615068228,481701128,706460287,354724069,930351659,330017155,661442131,347003920,61518452,250657111,67590316,968752097,277684995,1049865036,1046969323,133438389,557515226,291784276,408135716,312637500,854890166,437359747,79383093,581774259,265964838,867211620,149429738,271067652,1069547707,513721924,785305672,524257944,260172716,609805589,1061414943,809560748,19724700,22785990,306851135,876201613,449216256,279358691,640277250,917099496,555513887,511215822,1005690169,430717502,476470404,198102215,941019701,24583848,204922980,981812117,434925934,684177870,590390895,762167482,30836333,858381721,957317163,841102625,636000888,875337210,1016645680,1036055926,319684321,7582844,143147898,1001209621,530079263,824135874,901318851,193591085,48643232,462944097,1046071673,691565580,149585082,915451666,821920810,143948258,599606241,1048959828,841012742,195065490,969123573,391587229,656984631,121938841,221650274,67436306,930464591,94752054,16853707,991145974,456163688,990767415,422502572,671474433,956673927,499190062,322224770,677531423,77149454,792189447,693623975,1071873825,441233720,153683862,701149770,687164818,670572295,568155109,856837754,1801421,237944322,570015764,291756137,854217184,157414324,466610154,207160493,698102303,363402961,654127566,806262530,279256998,189571342,1027900054,698401491,980517802,158572755,457270142,774361528,1041633851,1063651746,142980713,209309361,110780310,729493274,564055026,1061451860,117912768,1063062636,519072698,407615658,551085475,34253708,463362562,290836596,998026540,973822719,277902232,537850855,1040066188,218707677,300714115,1015206174,955511312,729846206,29681856,491848112,86986678,810800211,244869425,853503400,923899560,207738592,884470078,604912407,998311665,507126727,849938059,776937151,630795937,302583787,965077162,638445757,106898683,737537960,971770280,583622896,898805008,430841602,792998244,770459769,68105582,520046674,160909907,515194661,618875159,991988605,731363925,498658179,121309908,614308976,851840553,31099757,890856024,886345617,936611441,884100093,466665723,1025498462,532382462,53701995,14861272,956877314,683316385,510091883,912634962,468997375,339438149,461656292,37411354,568412393,77387263,843420411,426958168,100840019,632638701,317700455,847522972,1035985908,794608480,286804011,332951445,450688497,881484377,24889134,76701268,376181366,342309421,524268368,493009748,721270875,742382877,750863211,524833434,337451067,438002206,563543442,8009369,650824176,907104334,399029054,302103313,880353817,924902952,745953483,199291369,663147054,463785342,347585111,759652852,908102120,56329368,329901720,479904228,378045883,135764199,686543651,858571770,919525767,28614096,150255725,335222834,155881565,996324240,334186950,81287282,47937726,665781536,537428032,811091332,248976773,531942796,1073117618,747783503,92841091,944132039,25025395,471901703,966545886,196766843,865469261,999712005,205415117,174077274,1034807941,993651719,244290881,721548974,431030342,584335493,125129270,929582198,308956437,425136871,563855276,726966908,1006730881,315900703,675497702,638349885,823524100,949173464,645434495,203567499,1030026136,697390463,56265953,795704750,541856531,770222896,409076668,1037519460,533035394,287483236,170114216,32650113,174238221,704924118,582945671,515073996,77963644,167171943,900941496,161294526,192366049,547668381,272709687,616778549,386261567,426391933,617341866,1013745064,698376547,12323598,737868976,427822158,80426408,311144972,876730062,1069955828,847616127,43165398,878361852,572894939,492100281,51833229,800552505,361203074,867275674,544899947,126072372,327037795,633337628,253842284,683638162,870728616,1060968174,768876240,44253874,30016202,739242071,549947542,992454532,1052519170,886990365,686614758,945834867,987204457,384497770,147734664,26278531,976499309,702627220,830164879,262899813,419443980,907458070,1015872604,606525431,160782249,803586023,111274908,178002638,170018401,410602379,432858412,221359306,860527358,869760018,625612264,233439818,210505671,386341284,364110161,224162888,405930680,602217197,118251689,858108143,780112670,64485283,811524535,855252333,704773326,56513214,809386116,880993177,308571607,503361821,422543336,1014511412,270694848,228725553,825931341,924656377,1037934944,718971754,880164586,891030113,168178446,476497659,116898230,25035362,748502337,296375856,154147389,120253251,712852028,603395551,492979968,136044686,403687974,145824364,418990937,1039805900,739452615,142955287,955864907,810934608,151263989,502178061,831620451,147136271,207324926,922295603,385781629,1015488999,190362491,726553738,558450679,94303975,735005004,742221321,463942246,791157297,95722899,496987975,190376911,942645424,687542832,885078009,570571029,488438532,763706732,351669844,684410624,831221387,551347298,625732080,866700530,540074049,139945054,851374250,969034669,620815619,3741604,637899176,127329284,287215946,645267451,841042752,524287394,504028596,189720245,816273233,896160312,855454376,140531808,921900145,657273957,585796058,903535788,1027869406,875440017,433701055,904141951,157244601,26061089,346860779,87068339,442456432,879320045,254450920,744660793,698271713,237713595,604207430,832353269,832225372,27759354,1030051343,410384466,488525334,949247493,401635443,123388351,31398159,248817364,711631247,792183356,577368207,589784611,589647089,338182225,266836566,607212437,160825676,46616162,962676693,689354620,480775647,264378907,1040920157,64424731,869045503,652202988,454995696,902239820,999269487,160037377,82920595,20490411,1071281778,759477544,105557798,908923249,302812917,947383664,462980840,1038214184,851284893,157111401,355327815,821443859,501571739,136405423,576049400,882403411,504824364,518962666,687657307,38794354,954787341,497576459,102727515,47623336,367047229,76250838,661188509,740268512,139741731,377377579,263167059,762303642,757523318,212446250,652838189,474241926,268579427,18146634,363548536,523538573,499657749,606645754,314755933,271805563,325210472,283896883,222916256,441403878,760295101,609365618,487833973,391688131,34638894,884045833,890905138,706235352,612092704,900419603,623377753,652681299,69129294,145852006,774641039,691770590,1014524655,283035673,256223603,729365269,575926051,850727516,933023411,759316771,164917634,801581019,524551938,692179486,787141389,330276018,236617837,649137600,394184607,175854414,882576400,966480838,57521647,953233853,276225971,832581156,913280232,117827672,1038762972,931715729,133522941,262680172,494503351,784388885,66074809,991113168,4759453,527048389,61553008,745026028,903739590,452816507,180048656,285191392,767574031,103963614,695068597,158291823,572724896,828195516,972116062,685343362,1016153908,1064332747,799460137,672423497,543301527,709372166,304179939,801861423,220091473,628712597,175386675,65894876,497939542,113283123,1035103319,2650951,887598733,149669412,131421672,632663409,872958852,570725756,809770610,941084491,722062140,154629566,470779774,316539983,628524861,874508952,435078723,851820037,646613628,919202407,20053350,908528101,439897908,591465927,720251278,44759553,168499976,449743613,668791775,579155434,196528138,846461976,80096424,424153978,67852686,196600670,557920859,901885039,796643962,759801828,819753919,1022618760,137138544,1070239358,778322524,1067261081,1034691341,395229353,56466338,1007670563,209496774,481670128,907026856,102353041,829959290,595464003,103242961,305556342,617906332,437149276,633378840,63763683,510312263,35709699,188418537,70433319,480655255,83212701,957822150,753041469,552114279,109076746,344352889,826562792,257654777,394200877,503220653,709965653,257000997,351020236,13067838,175835753,140893151,542899394,579138646,254256467,603696022,596390390,1052537551,1026206807,494072635,515530742,933092533,621999974,848718866,148845045,449041576,660268585,796271432,669440586,30935313,955184253,547132644,667786378,18942992,563769278,185362052,1034825023,1065974212,496809753,258121089,815403886,233603222,400554197,529288043,587918231,913585412,836250395,851030023,542371598,734671552,353340736,777233834,383690502,909175261,674498900,118453723,917283446,777841226,934928119,288083633,181100153,201883921,955595755,778236209,216925166,95973552,32183852,178576446,376654178,415298513,145956798,601787588,988694825,563494176,65329423,103451065,436478779,59714126,89653324,972136110,881117582,1038189781,197984221,919026972,719833767,193696853,332979871,951505890,252714827,507944126,1029434193,25800376,67954096,204217345,758005340,642997469,499039729,872011142,97244289,397257350,107888041,135798708,917317511,605119738,306923855,361639495,447520689,693795019,366181826,418344305,635475905,631864268,925040782,521904070,921727921,852790419,164785616,454849626,685775274,795540323,618576095,921058905,967085798,746188154,339209797,262229772,221784233,916355440,151884471,525705314,652204658,449647205,463691110,939839536,272091860,436449914,497748865,362796450,575605566,952439554,932546964,700195853,619005953,77527320,853206193,52505121,690765403,1012487339,469238930,289469281,549760719,634256432,35891318,1010127706,137825239,618889038,123603036,88137589,1028350064,288777309,429382052,467768743,383778022,869086462,797666472,86943722,153744778,965927091,1042803020,563247714,13565382,877643677,849096930,188269604,1004937248,1035374177,513008802,112140755,774929074,661090962,932493410,200252678,824181604,730204056,6315462,484244477,53920778,316002172,673245443,702374182,453719751,312285432,258576899,143566324,341928460,609350708,48250215,563718693,112370653,1044320808,328549557,75391569,175922906,658454465,336303773,895056659,837183095,550028597,365669315,1053925089,739254290,137256589,980617153,40793849,1010816877,728634077,762600922,559073349,1037816166,638303639,401282043,753548243,788939225,662210247)
hash_value_3 = (846057222,974138809,547375658,735007452,58804698,586438402,909349889,711021123,591281585,803594374,402292800,1048357145,17851934,83685771,514308382,80289770,460157627,694172383,414111663,158667087,170601483,891828316,341292297,1038379547,1052972421,777740533,183918394,276569163,693459551,522248633,535819432,131994142,110867068,106050064,235480711,375936034,630890114,236055432,164135898,290863131,158605879,458454575,301015409,963529179,25686536,386626851,458875519,98512006,315365310,97219212,307730429,756184819,980473874,543274154,323271511,796715559,246778001,731030308,941869813,277395421,795002322,233805330,961862234,547241815,612019607,64591738,261441827,383040488,822414305,357432088,1041809892,346885163,632731535,251106423,598792097,842717075,576545724,971282204,854909150,221100667,680272982,831133138,766475106,799908443,321861568,681226210,919806618,534087847,978292621,925723700,529284270,224395297,974558319,197553184,1012260403,127209595,187261399,885561696,50311618,1033696726,744947289,417260056,963232898,511180335,927745045,177883459,855769828,142107260,53600051,496751178,465918801,232506978,102001020,29761354,283933738,718114480,971248082,1014379118,817312222,365417052,393280573,1032795728,630514471,602680784,195275382,36701110,823620736,1022419847,251724424,994987883,441315927,489518117,326961391,989543068,586555328,1054302016,996253731,1047370399,1340815,65052945,703136467,125108111,660947926,435093959,75338302,200513980,509549760,293338053,1015913054,473460879,598129094,270637846,238509752,993148188,316277315,257431386,559824085,356627674,922552114,706774464,981499217,12784306,243720949,78723608,826194209,355351250,244367644,27880040,661307428,976706222,797716121,606505483,829089320,1025416778,219657540,805500837,602551574,1033818402,310781581,328879461,790422969,630199646,444298217,953506697,98613152,102362741,928890275,817399244,460714227,62543922,225546509,697605038,104060463,251782230,557077499,95107771,309326387,885051488,608356770,1056003601,951932001,346220234,109838758,400614478,94760348,872986558,831698256,959718763,597889590,410575785,283781712,1027491090,229158311,410754107,151481395,735004572,865452289,365167326,323575081,772459390,719251597,456476414,398720514,333391001,106666168,240130359,779064385,199695660,274160183,400681388,745394147,937978158,768236629,302648258,1013100746,709374275,764287724,577898640,7045273,758317119,493522478,208694174,487562669,321611250,564511446,741254181,757676140,827697560,608229791,812442519,714461610,297572772,393932409,377570405,221592800,613942316,1063942299,446582163,284338745,787662094,423269262,850079532,843400406,101134779,947029791,239286818,800344369,416849779,846316852,444689707,1026145750,939393731,811670767,192241930,52300805,391459640,659995361,471250712,602009392,471296901,383966117,662252780,473985858,1066587919,450787003,246574608,437615287,649935750,829263973,99231897,336050082,918238776,360317620,904401669,309827765,505153534,1072590676,265682967,1047072445,73602785,191830650,294770644,77092423,1072810037,291422816,35445019,350437517,30749871,543197162,900201483,514732353,290712883,564341381,164258741,129674061,508807557,410656376,584393200,430977894,936848078,117430390,112809084,1014186285,17573119,371399369,935244433,131452506,950361822,536264009,488228136,136812855,334974762,658635603,635766411,279749008,1028361543,306271260,440426948,776995330,894833273,785677349,756689137,383817282,411085570,517736897,94098420,354571263,891210706,811037433,849053398,933536799,876362354,1058236145,397017615,571333049,298948006,49923222,558936283,649563032,96468131,736842746,523954884,274111177,893051664,886152510,715360730,382675279,514150185,869861045,846446256,113438390,466588666,536505778,534516953,132726223,898620979,1036306226,906889005,276305477,796662925,366050325,1039553137,5611554,994092709,296681438,386418669,65362885,681878334,890088380,894704053,680439754,521194445,404482515,781991980,85454969,189782565,233821893,647902401,509090057,22190946,656115003,900319524,523624467,200537652,340948594,943483974,273907424,64313862,637886438,672711075,460113201,163368106,108879349,34746827,887256700,959773287,728975734,424146377,247633137,469633239,481123140,776927245,588322125,652152349,949775798,272463498,658969421,260810855,442100445,835538496,697806746,1059968218,458172394,294856945,316090926,775050798,190636818,622359486,70901141,321385688,435547661,721218741,523139771,320249512,337209727,313675497,36662047,144217804,599377828,1004605029,723501883,665150197,1044642885,382180319,736021384,936151271,424325221,934514323,356363563,384331112,132413027,331561993,286179565,412380719,928095535,724036981,646641785,96893512,117021196,663917332,1027555821,209511593,503623765,857345565,51187128,666790700,518802566,322467744,43614567,41744489,866878518,973961004,929872212,869043322,591540992,442329948,642437616,382746786,102517568,867369710,800506939,544641058,342411101,278493807,213058282,783656385,88061552,558000395,368641240,958180277,777286295,511839831,1027748515,310146390,953602267,906343498,158831283,963478442,538072818,645945008,724839865,470772785,1008108652,316056811,47588056,41271970,263731250,559571008,974279536,233524289,792602351,587924863,1028050593,1026116991,666771733,871505889,677287579,570543901,63497446,436631056,603890537,714407614,397631546,1055428723,524712232,132795054,350579919,428726769,69737968,246070187,326928589,269377301,416448651,774807037,427707948,378972091,341945573,804659511,192819237,553046165,441596558,985755321,99831548,336857622,295086256,847120707,210013970,274931378,917513121,184638858,621162868,314167508,175764046,938956247,106380106,686105817,614310932,258789851,774960065,760876680,829559928,294882270,267849036,747697829,20217410,541143241,582200909,892191277,167447046,1030263504,742477732,766651778,166877022,740041920,967883309,208646084,21183441,995826633,633424909,219728378,762048249,832886600,418669873,811819957,497074162,547669624,212747695,308468211,3571538,956207929,288050462,796792109,468155123,985493534,865344438,88798039,581704203,255582559,276994232,478979177,678746448,982592225,875742388,384227852,603329986,437869008,202848617,54233577,472820886,938525367,137300182,732805930,24132389,510903269,360097062,69677722,701108698,540764583,746633336,772865173,748531522,765644593,940720506,307960125,898911572,582112748,490987951,944224809,1062891318,845531018,807861506,729861423,913703415,125485117,485924390,217314362,736923298,585490885,773783585,1043432710,633604857,417265771,959940345,259380264,351992390,276295794,419298510,910057211,811439698,28153577,941581021,285432335,401645561,975056823,100526704,402186915,949636599,924950917,165780546,388444132,930585864,810300836,630867804,790318255,265863502,132705399,372925059,475688416,541001711,9033248,347924385,1047740893,552460560,36286776,131952764,198615382,797295752,752978926,857730808,948934254,880380466,576546549,945076997,373567155,522620217,14199925,605704339,820917375,736527745,987785599,627555129,715385963,935025404,295131178,283500428,913965394,731200203,173825606,644335261,954645665,745099450,943535513,731404817,1001623393,421214757,115572363,38204859,777183256,260004838,508503123,573553954,391174636,752052489,235154262,636503031,167145470,844536951,36039849,71975198,863384181,367041728,632217843,122841993,738287735,126527184,160865519,796734180,250672321,1009835775,1051379423,202228845,954192682,673200878,1026977826,526479255,35556763,896079165,1007924203,473459495,1070222953,422004449,219552539,1046198359,441596282,888062609,408463386,721939848,649739462,922632663,107278322,4757776,312264795,967753922,638792806,811724835,174172143,46181999,710109014,142511273,966159864,846096864,867327528,98229600,536152606,826149315,918695056,870694128,598749058,657870602,1040483008,902556197,99350953,335064015,125513098,819222367,41052988,417369249,526146772,498503122,411252453,818924753,496742799,880852056,205249801,448245164,961802144,702055207,687756306,448727246,680492589,719112532,542160396,1010976385,855002538,777914287,606279179,1024429335,227360955,425010891,398862496,724980090,113562158,62743902,837718674,1073306308,673285220,308469030,682801885,912329304,124047744,51721664,1030591256,198179124,1059057837,138761026,600940201,124502407,693177715,256841087,440393302,30851735,915821080,664627632,1052107449,142803167,853762895,968227900,748113560,873186169,634660670,366430359,806357249,438802920,120781684,122886499,952011138,476730543,399041080,344884729,120722582,353354640,430948737,650227977,198422304,377779947,1040590474,1050774096,701378614,12619849,815198812,248848977,164763532,869748940,679064923,619464704,3001372,642577948,387225880,785139491,747188059,225375319,87653531,359813589,99502437,633826145,341394083,1063300336,751172455,656953681,615252606,110857088,1065878418,611857378,877686859,791588277,327953933,709542029,727897866,191531397,565530182,402494564,410055822,142480654,196094013,535888175,621545354,324464538,246185374,158837908,422101411,1024694314,788597404,795457559,726700766,622231779,706216778,52830007,91547548,858648916,219119032,198254427,237363613,610350730,946827491,6527109,1056734964,903112455,113322120,721266913,158120853,418491502,375635515,468932682,790959692,748094448,274081884,209807877,135108280,8568621,432645043,287377130,322269512,930273569,772678929,397373697,624402047,381995843,784904394,101018646,382249205,175524795,769933716,771123987,378274860,332799065,578748087,726584845,109362152,467168699,843299002,285571372,943503760,371781822,152944627,319418569,353313159,927915339,232455379,161433525,292628295,694761217,941898162,1576985,907497087,640832234,1044153089,658525154,49372,677484421,550690374,135291750,542630757,575339007,885417005,632036155,974805878,571796396,309631016,764018517,212401078,781390285,985636886,925715489,893963931,123834364,737583538,347739299,301983921,722082567,264917868,692278258,577330185,877591867,41074752,825078605,598895228,729932074,305256420,1021478996,267269701,295822684,322308388,965257259,79255710,510037878,1045091470,640504057,87915467,416954099,893227744,897085506,1010354906,784877416,940564014,13782386,614186106,51227971,786048714,340586312,245056897,763465501,211070755,540914144,812507965)



def myhash1(i, j):
	return hash_value_1[i] ^ hash_value_2[j]

def myhash2(i, j):
	return hash_value_1[i] ^ hash_value_3[j]

def myhash3(i, j):
	return hash_value_2[i] ^ hash_value_3[j]

def sketch_update_row(sketch, sketch_len, index_i, index_j, hash_func, update_value):
	hash_value = hash_func(index_i, index_j) % sketch_len
	sketch[hash_value] = min(sketch[hash_value], update_value)
	
# M is the original matrix waiting for encoding into the hash array -- the return value. 
# base is the number of bits used in M
# com_ratio is the compression ratio.
def sketch_encoding(M, base, com_ratio, float_step):

# now M is float 32 used in training
# 
# @En-Yu, please do float-int transformation for M here
# 
# now M locates in [-128, 127], and is int
	M_int = (M / float_step).astype(np.int32)
	
	i_len = M_int.shape[0]
	j_len = M_int.shape[1]

	#sketch_len = int(i_len * j_len * (com_ratio - 1.0/base)+ 1)
	sketch_len = int(i_len * j_len * (com_ratio)+ 1)

	sketch = np.zeros((sketch_len,), dtype=np.int32)
	indicator = np.zeros((i_len,j_len), dtype=np.int32)

	for i in range(0, i_len):
		for j in range(0, j_len):
			if(M_int[i][j] == 0):
				indicator[i][j] = 0
			else:
				if (M_int[i][j] > 0):
					indicator[i][j] = 1
				elif (M_int[i][j] < 0):
					indicator[i][j] = -1
				sketch_update_row(sketch, sketch_len, i, j, myhash1, abs(M_int[i][j]))
				sketch_update_row(sketch, sketch_len, i, j, myhash2, abs(M_int[i][j]))
				sketch_update_row(sketch, sketch_len, i, j, myhash3, abs(M_int[i][j]))

	return [sketch, indicator]

def sketch_getvalue(sketch, sketch_len, index_i, index_j):
	hash_value1 = myhash1(index_i, index_j) % sketch_len
	hash_value2 = myhash2(index_i, index_j) % sketch_len
	hash_value3 = myhash3(index_i, index_j) % sketch_len
	return max(sketch[hash_value1], sketch[hash_value2], sketch[hash_value3])


# sketch/2/indicator -> np.int32, M -> np.float32
def sketch_decoding(sketch, indicator, base, com_ratio, float_step):
	i_len = indicator.shape[0]
	j_len = indicator.shape[1]

	M = np.zeros((i_len, j_len), dtype=np.float32)
	sketch_len = int(i_len * j_len * (com_ratio) + 1)

	for i in range(0, i_len):
		for j in range(0, j_len):
		#	if(indicator[i][j] == 0):
		#		M[i][j] = 0
		#	else:
			M[i][j] = indicator[i][j]*(sketch_getvalue(sketch, sketch_len, i, j)) * float_step

# now M is natural float 32 
# 
# @En-Yu, please do float-float transformation for M here
# 
# now M is float 32 used in training

	return M


def sketch_transform(M, base, com_ratio, float_step):
	sketch = sketch_encoding(M, base, com_ratio, float_step)
	M1 = sketch_decoding(sketch[0], sketch[1], base, com_ratio, float_step)
	return M1



def test():
	com_ratio = 0.9
	shape1 = 64
	shape2 =64
	base = 8
	float_step = 0.008381030138801126
	#half_base_mask = 1<<(base-1)


	# M = np.random.uniform(-half_base_mask * float_step, (half_base_mask - 1) * float_step, size=(shape1, shape1))

	M = np.load( "to_yang.npy" )
	print(M)

	M1 = sketch_transform(M, base, com_ratio, float_step)
	print(M1)

if __name__ == '__main__':
	test()